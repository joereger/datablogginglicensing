
<project name="MainBuild" default="buildWar" basedir=".">
  <description>
        Builds the licensing app.
  </description>

                 

  <!-- Create a buildnumber -->
  <target name="buildnumber" description="Create a build number.">
     <echo message="Generating build number."/>
     <buildnumber/>
  </target>

  <!-- Create a timestamp -->
  <target name="timestamp" description="Create the dirs" depends="buildnumber">
  	 <echo message="Generating timestamp."/>
     <tstamp>
        <format property="build.time" pattern="yyyy-MM-dd-(hh-mm-ssaa)"/>
     </tstamp>
  </target>

  <!-- Import build number file -->
  <property file="build.number"/>

  <!-- Set internal script properties -->
  <property name="tomcat.app.name" value="regerLicensing"/>
  <property name="lastbuild" location="builds/lastbuild/regerLicensing"/>
  <property name="wardir" location="builds/WARs/regerLicensing"/>
  <property name="javasrc" location="builds/lastbuild/regerLicensing/WEB-INF/classes"/>
  <property name="builddir" location="builds"/>
  <property name="sourcedir" location="source"/>


  <!-- First, Delete any files in the lastbuild folder -->
  <target name="cleanuplastbuild" description="Cleans up the last build" depends="timestamp">
    <echo message="Cleaning up lastbuild for: ${tomcat.app.name}"/>
    <delete dir="${lastbuild}"/>
  </target>

  <!-- This target takes all files required for the build and puts them into lastbuild which is basically a temp building location -->
  <!-- This is done so that I can have Vars.java and VarsDev.java, choosing which one to put into the build at buildtime -->
  <target name="movefilestolastbuild" description="Moves files to the lastbuild directory." depends="cleanuplastbuild">
      <copy todir="${lastbuild}">
        <fileset dir="${sourcedir}" excludes="**.*Thumbs.db"/>
      </copy>
  </target>




  <!-- Compile the app-->
   <target name="compile" description="compile the source" depends="movefilestolastbuild">
  	 <echo message="Compiling Java code."/>
     <javac srcdir="${javasrc}" excludes="**.x" debug="on" classpath=""/>
   </target>

   
   <!-- Package the app for Dev -->
   <target name="package" description="Create the WAR file" depends="compile">
        <echo message="Packaging ${tomcat.app.name}'s war file."/>
        <delete>
            <fileset dir="." includes="*.war"/>
        </delete>
        <war destfile="${tomcat.app.name}-(bld${build.number})-${build.time}.war" webxml="${lastbuild}/WEB-INF/web.xml">
            <fileset dir="${lastbuild}">
                <exclude name="**/*.java"/>
                <exclude name="**/web.xml"/>
            </fileset>
        </war>
		<copy file="${tomcat.app.name}-(bld${build.number})-${build.time}.war" todir="${builddir}"/>
   </target>

   <target name="packagewithsource" description="Backup source files" depends="package">
        <echo message="Backing up ${tomcat.app.name}'s source."/>
        <jar jarfile="${builddir}/${tomcat.app.name}-(bld${build.number})-${build.time}-src.jar">
            <fileset dir="./">
                <exclude name="builds/**"/>
            </fileset>
        </jar>
   </target>

   


    
    <!-- Dev WAR file builders -->
    <!-- Use to build WAR file to manually deploy. -->
    <!-- It will be called ROOT.war and will be found in the root build directory -->
    <target name="buildWar" description="Builds a war file and does not deploy it." depends="packagewithsource">
        <echo message="Creating licensing.war for ${tomcat.app.name}."/>
        <copy file="${tomcat.app.name}-(bld${build.number})-${build.time}.war" tofile="${wardir}/licensing.war" overwrite="true"/>
		<delete file="${tomcat.app.name}-(bld${build.number})-${build.time}.war"/>
    </target>





    <!-- Create javaDoc -->
    <target name="createJavaDoc" description="Creates javadoc" depends="">
        <echo message="Creating javaDoc for ${tomcat.app.name}."/>
        <delete dir="${builddir}/javaDoc"/>

        <javadoc destdir="${builddir}/javaDoc" author="true" version="true" use="true" windowtitle="Reger.com javaDoc">

            <packageset dir="${sourcedir}/WEB-INF/classes" defaultexcludes="yes">
                <include name="reger/**" />
            </packageset>

            <doctitle><![CDATA[<h1>Reger.com</h1>]]></doctitle>
            <bottom><![CDATA[<i>Copyright &#169; 2005 Reger.com. Confidential and proprietary. All Rights Reserved.</i>]]></bottom>

        </javadoc>

    </target>
	
    

    

    

</project>
